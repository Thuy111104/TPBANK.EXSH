<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Auto Vote Client-side</title>
</head>
<body>
<h2>Auto Vote Tool</h2>
<textarea id="cookieBox" placeholder="Nhập cookie, mỗi cookie 1 dòng"></textarea><br>
<button onclick="startVoting()">Bắt đầu</button>
<pre id="output"></pre>

<script>
const output = document.getElementById("output");

function log(msg) {
    output.textContent += msg + "\n";
    output.scrollTop = output.scrollHeight;
}

function sendVote(cookie, index) {
    fetch("http://localhost:3000/vote", {
        method: "GET",
        headers: { "Cookie": cookie }
    })
    .then(res => res.text())
    .then(text => {
        if (text.includes('"Success":true') || text.includes("Bình chọn thành công")) {
            log(`[COOKIE ${index}] ✅ Vote thành công!`);
        } else {
            log(`[COOKIE ${index}] ❌ Vote thất bại: ${text.slice(0,100)}...`);
        }
    })
    .catch(err => log(`[COOKIE ${index}] Lỗi: ${err}`));
}

function startVoting() {
    const cookies = document.getElementById("cookieBox").value.split("\n").map(c=>c.trim()).filter(c=>c);
    if (cookies.length === 0) return alert("Nhập ít nhất 1 cookie");

    log("=== Bắt đầu auto vote ===");

    cookies.forEach((cookie, index) => {
        // chạy lần đầu ngay
        sendVote(cookie, index+1);

        // tự động lặp lại sau 1 giờ (3600000ms)
        setInterval(() => sendVote(cookie, index+1), 3600000);
    });
}
</script>
</body>
</html>
